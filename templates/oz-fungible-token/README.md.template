# MyFungibleToken - OpenZeppelin Compact Contracts Template

A production-ready **OpenZeppelin Fungible Token** implementation for the Midnight blockchain, built with [OpenZeppelin Compact Contracts](https://github.com/OpenZeppelin/compact-contracts).

This template provides a complete ERC-20-like token with advanced features including minting, burning, pausable operations, and ownership management - all backed by OpenZeppelin's battle-tested contract modules.

## âš ï¸ Important Notice

> **OpenZeppelin Compact Contracts Dependency**  
> This project relies heavily on [OpenZeppelin Compact Contracts](https://github.com/OpenZeppelin/compact-contracts), which is currently a **Work In Progress (WIP)** project. The dependencies are pulled directly from the `main` branch of the OpenZeppelin repository.
>
> **What this means:**
> - âœ… You always get the latest features and security updates from OpenZeppelin
> - âš ï¸ The OpenZeppelin contracts are still under active development
> - âš ï¸ Breaking changes may occur as OpenZeppelin evolves their Compact implementation
> - âš ï¸ API interfaces and functionality may change without notice
>
> **Recommendations:**
> - ğŸ§ª **Test thoroughly** before deploying to mainnet
> - ğŸ“ **Review OpenZeppelin's repository** for updates: https://github.com/OpenZeppelin/compact-contracts
> - ğŸ”„ **Run tests regularly** to catch any breaking changes
> - ğŸ’¬ **Join the community** for updates and support
> - ğŸš€ **Start with testnet** deployments to validate functionality
>
> This template is provided as-is and should be used for development and testing purposes. Always perform your own security audits before production deployment.

## ğŸŒŸ Features

### Token Functionality
- **ERC-20 Compatible**: Standard token interface with `transfer`, `approve`, and `transferFrom`
- **Minting**: Owner can mint new tokens to any address
- **Burning**: Owner can burn tokens to reduce supply
- **Pausable**: Owner can pause/unpause all token transfers
- **Ownable**: Secure ownership management with transfer capabilities

### Development Features
- âœ… **40+ Comprehensive Tests**: Full test coverage using OpenZeppelin's Simulator
- ğŸš€ **Fast Local Testing**: Test instantly without network deployment
- ğŸ“¦ **Production-Ready Deployment**: Deploy to Midnight testnet/mainnet
- ğŸ¨ **Interactive CLI**: User-friendly command-line interface
- ğŸ”§ **TypeScript Support**: Full type safety and IDE support
- ğŸ“Š **Health Check**: Verify your environment setup

## ğŸ“‹ Prerequisites

- **Node.js**: Version 22 or higher
- **Docker**: Required for proof server (local development)
- **Midnight Wallet**: Testnet tokens for deployment

## ğŸš€ Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Configure Environment

Copy the environment template and configure your settings:

```bash
cp .env.template .env
```

Edit `.env` with your configuration:

```bash
# Network Configuration
NETWORK=testnet
NODE_URL=https://rpc.testnet.midnight.network
PROOF_SERVER_URL=http://localhost:6300

# Wallet Configuration (will be filled after wallet generation)
PRIVATE_KEY=
WALLET_ADDRESS=

# Token Configuration
TOKEN_NAME=MyFungibleToken
TOKEN_SYMBOL=MFT
TOKEN_DECIMALS=18
INITIAL_SUPPLY=1000000
```

### 3. Generate Wallet

Create a new Midnight wallet:

```bash
npm run generate-wallet
```

This will:
- Generate a new wallet with private key and address
- Save it to `wallet.json`
- Display your wallet address

**âš ï¸ SECURITY WARNING**: Never commit `wallet.json` or share your private key!

### 4. Start Proof Server (For Deployment)

If you plan to deploy to the network, start the local proof server:

```bash
npm run proof-server
```

This starts a Docker container with the Midnight proof server on port 6300.

### 5. Run Tests (Recommended First Step)

Test your contract locally without deploying:

```bash
npm test
```

This runs 40+ tests covering:
- Token deployment and initialization
- Transfer operations
- Approval and transferFrom
- Minting and burning
- Pausable functionality
- Ownership management
- Edge cases and complex scenarios

### 6. Deploy Contract

Deploy your token to the Midnight testnet:

```bash
npm run deploy
```

This will:
- Connect to the Midnight network
- Deploy your token contract
- Save deployment info to `deployment.json`
- Display your contract address

### 7. Interact with Contract

Use the interactive CLI to interact with your deployed token:

```bash
npm run cli
```

Available operations:
- ğŸ’° Check Balance
- ğŸ“Š View Token Info
- ğŸ’¸ Transfer Tokens
- âœ… Approve Spending
- ğŸ”„ Transfer From
- ğŸª™ Mint Tokens (Owner)
- ğŸ”¥ Burn Tokens (Owner)
- â¸ï¸ Pause Contract (Owner)
- â–¶ï¸ Unpause Contract (Owner)
- ğŸ‘¤ Transfer Ownership (Owner)

## ğŸ“š Available Scripts

### Development

```bash
# Run tests
npm test

# Run tests in watch mode
npm run test:watch

# Run tests with UI
npm run test:ui

# Compile contract
npm run compile

# Build TypeScript
npm run build

# Development mode (watch + rebuild)
npm run dev
```

### Deployment & Interaction

```bash
# Deploy contract to network
npm run deploy

# Interactive CLI
npm run cli
```

### Utilities

```bash
# Generate new wallet
npm run generate-wallet

# Check system health
npm run health-check

# Start proof server
npm run proof-server
```

## ğŸ—ï¸ Project Structure

```
.
â”œâ”€â”€ contracts/
â”‚   â””â”€â”€ MyFungibleToken.compact    # Main token contract (imports OZ modules)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli.ts                     # Interactive CLI
â”‚   â”œâ”€â”€ deploy.ts                  # Deployment script
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â””â”€â”€ midnight-providers.ts  # Network providers
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ environment.ts         # Environment helpers
â”‚       â”œâ”€â”€ health-check.ts        # System health check
â”‚       â””â”€â”€ wallet-generator.ts    # Wallet generation
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ MyFungibleToken.test.ts    # 40+ test cases
â”‚   â””â”€â”€ MyFungibleTokenSimulator.ts # Simulator wrapper
â”œâ”€â”€ witnesses/
â”‚   â””â”€â”€ MyFungibleTokenWitnesses.ts # Witness functions
â”œâ”€â”€ .env.template                   # Environment template
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vitest.config.ts
```

## ğŸ§ª Testing

This template uses **Vitest** and **OpenZeppelin's Simulator** for fast, reliable testing.

### Test Structure

The test suite (`tests/MyFungibleToken.test.ts`) includes 40+ tests organized into:

1. **Deployment & Initialization** (5 tests)
   - Token metadata (name, symbol, decimals)
   - Initial supply verification
   - Owner setup
   - Initial paused state

2. **Transfer Operations** (5 tests)
   - Basic transfers
   - Multiple transfers
   - Balance tracking
   - Return values

3. **Approval & TransferFrom** (6 tests)
   - Approve spending
   - TransferFrom operations
   - Allowance tracking
   - Multiple approvals

4. **Minting** (3 tests)
   - Owner minting
   - Supply increase
   - Multiple recipients

5. **Burning** (2 tests)
   - Token burning
   - Supply decrease

6. **Pausable Functionality** (5 tests)
   - Pause/unpause
   - Blocked operations when paused
   - Resume after unpause

7. **Ownership Management** (3 tests)
   - Transfer ownership
   - New owner operations
   - Renounce ownership

8. **Edge Cases & Complex Scenarios** (3+ tests)
   - Large transfers
   - Complex interactions
   - Supply consistency

### Running Tests

```bash
# Run all tests
npm test

# Watch mode (reruns on changes)
npm run test:watch

# UI mode (interactive browser-based)
npm run test:ui
```

### Why Test Locally First?

âœ… **Instant feedback** - No network delays  
âœ… **No costs** - No testnet tokens required  
âœ… **Reliable** - No network issues  
âœ… **Fast iteration** - Test while developing  
âœ… **Same behavior** - Simulator matches network exactly

## ğŸš¢ Deployment

### Prerequisites

1. **Funded Wallet**: Your wallet needs testnet tokens
2. **Proof Server**: Must be running (`npm run proof-server`)
3. **Environment**: `.env` configured correctly

### Deployment Process

```bash
npm run deploy
```

The deployment script will:
1. Validate environment configuration
2. Connect to Midnight network
3. Deploy your token contract
4. Save deployment info to `deployment.json`

### Deployment Info

After deployment, `deployment.json` contains:

```json
{
  "contractAddress": "0x...",
  "deployedAt": "2024-01-01T00:00:00.000Z",
  "network": "testnet",
  "tokenName": "MyFungibleToken",
  "tokenSymbol": "MFT",
  "decimals": 18,
  "initialSupply": "1000000",
  "owner": "0x..."
}
```

## ğŸ¨ CLI Usage

The interactive CLI provides a user-friendly interface to interact with your deployed token.

### Starting the CLI

```bash
npm run cli
```

### Available Operations

#### For All Users

- **Check Balance**: View token balance of any address
- **View Token Info**: See token metadata and status
- **Transfer Tokens**: Send tokens to another address
- **Approve Spending**: Allow another address to spend your tokens
- **Transfer From**: Transfer tokens on behalf of another address (if approved)

#### For Contract Owner Only

- **Mint Tokens**: Create new tokens and send to any address
- **Burn Tokens**: Destroy tokens to reduce supply
- **Pause Contract**: Disable all token transfers
- **Unpause Contract**: Re-enable token transfers
- **Transfer Ownership**: Transfer contract ownership to a new address

### Example Workflow

1. **Check your balance**:
   ```
   Select: Check Balance
   Enter your wallet address
   ```

2. **Transfer tokens**:
   ```
   Select: Transfer Tokens
   Enter recipient address
   Enter amount (e.g., 100.5)
   ```

3. **Mint new tokens** (owner only):
   ```
   Select: Mint Tokens (Owner)
   Enter recipient address
   Enter amount to mint
   ```

## ğŸ”§ Contract Customization

### Modifying Token Parameters

Edit `.env` before deployment:

```bash
TOKEN_NAME=MyCustomToken
TOKEN_SYMBOL=MCT
TOKEN_DECIMALS=18
INITIAL_SUPPLY=5000000
```

### Adding Custom Functionality

The contract (`contracts/MyFungibleToken.compact`) imports OpenZeppelin modules:

```compact
import { FungibleToken_ } from '@openzeppelin-compact/contracts/token/fungible-token';
import { Ownable_ } from '@openzeppelin-compact/contracts/access/ownable';
import { Pausable_ } from '@openzeppelin-compact/contracts/utils/pausable';
```

You can:
1. Add more circuits to the contract
2. Import additional OZ modules (when available)
3. Customize circuit logic
4. Add custom state management

### Testing Custom Changes

After modifying the contract:

1. Update tests in `tests/MyFungibleToken.test.ts`
2. Run tests: `npm test`
3. Verify all tests pass
4. Deploy: `npm run deploy`

## ğŸ› Troubleshooting

### Common Issues

#### 1. "Wallet file not found"

```bash
npm run generate-wallet
```

#### 2. "Proof server not responding"

```bash
# Check if Docker is running
docker ps

# Start proof server
npm run proof-server

# Verify it's running
npm run health-check
```

#### 3. "No deployment found"

You need to deploy first:
```bash
npm run deploy
```

#### 4. "Node.js version too old"

Upgrade to Node.js 22+:
```bash
# Using nvm
nvm install 22
nvm use 22
```

#### 5. Tests failing

```bash
# Clean and reinstall
rm -rf node_modules
npm install

# Recompile
npm run compile

# Run tests
npm test
```

### Health Check

Run the health check to diagnose issues:

```bash
npm run health-check
```

This checks:
- âœ… Node.js version
- âœ… Environment variables
- âœ… Wallet existence
- âœ… Docker installation
- âœ… Proof server status
- âœ… Proof server health

## ğŸ“– OpenZeppelin Compact Contracts

This template uses **OpenZeppelin Compact Contracts** - the gold standard for secure smart contracts, now available for Midnight.

### What are OpenZeppelin Contracts?

OpenZeppelin is the most trusted name in smart contract security, with contracts securing over **$1 trillion** in value. Their contracts are:
- ğŸ›¡ï¸ **Battle-tested**: Used by thousands of projects
- ğŸ”’ **Audited**: Professionally audited by security experts
- ğŸ“š **Well-documented**: Comprehensive documentation
- ğŸ¯ **Best practices**: Industry-standard implementations

### Compact Contracts for Midnight

OpenZeppelin Compact Contracts brings these benefits to Midnight's privacy-preserving blockchain:
- Same security guarantees
- Adapted for Midnight's Compact language
- Compatible with Midnight's zero-knowledge architecture
- Modular and composable

### Available Modules (in this template)

- **FungibleToken**: ERC-20-like token implementation
- **Ownable**: Ownership management
- **Pausable**: Emergency pause functionality

### ğŸš§ Work In Progress Status

**Important:** OpenZeppelin Compact Contracts is currently under active development. This template pulls contracts from the `main` branch, which means:

- **Automatic Updates**: Running `npm install` fetches the latest version from OpenZeppelin's repository
- **Active Development**: Features and APIs may change as the project evolves
- **Community Driven**: OpenZeppelin is actively working on this implementation
- **Production Caution**: Thoroughly test and audit before deploying to mainnet

**Stay Updated:**
- Monitor the [OpenZeppelin Compact Contracts repository](https://github.com/OpenZeppelin/compact-contracts) for changes
- Review commit history before major deployments
- Join the Midnight and OpenZeppelin communities for announcements
- Re-run your test suite regularly to catch breaking changes

### Learn More

- [OpenZeppelin Contracts](https://www.openzeppelin.com/contracts)
- [OpenZeppelin Compact Contracts (GitHub)](https://github.com/OpenZeppelin/compact-contracts)
- [Midnight Documentation](https://docs.midnight.network)

## ğŸ” Security

### Best Practices

1. **Never commit secrets**:
   - `wallet.json` is in `.gitignore`
   - Never share your private key
   - Keep backups secure

2. **Test thoroughly**:
   - Run all tests before deployment
   - Test on testnet before mainnet
   - Verify all functionality

3. **Start small**:
   - Deploy with small amounts first
   - Test all operations
   - Increase usage gradually

4. **Monitor deployment**:
   - Keep `deployment.json` backed up
   - Track contract address
   - Monitor transactions

### Audit Recommendations

For production use:
- âœ… Run comprehensive tests
- âœ… Have contract reviewed by security experts
- âœ… Test on testnet extensively
- âœ… Start with limited token supply
- âœ… Implement monitoring and alerts

## ğŸ“ License

This template is MIT licensed.

OpenZeppelin Compact Contracts are MIT licensed.

## ğŸ¤ Contributing

Found a bug or have a suggestion? Please open an issue!

## ğŸ†˜ Support

- [Midnight Documentation](https://docs.midnight.network)
- [Midnight Discord](https://discord.gg/midnight)
- [OpenZeppelin Forum](https://forum.openzeppelin.com)

## ğŸ‰ Next Steps

Now that you have your token deployed:

1. **Test extensively**: Use the CLI to test all features
2. **Build a dApp**: Create a frontend for your token
3. **Integrate**: Connect with other Midnight contracts
4. **Explore**: Try the NFT and Multi-token templates (coming soon)

Happy building on Midnight! ğŸŒ™âœ¨
